<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UK Polling Analysis</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <style>
        .plot-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin: 20px 0;
        }
        #pollingPlot {
            width: 100%;
            height: 600px;
        }
        .code-section {
            margin: 30px 0;
        }
        .code-button {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            margin: 10px 0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: none;
            cursor: pointer;
        }
        .code-button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 1000px;
            border-radius: 10px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: black;
        }
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .stats-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin: 20px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .stat-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        .python-plot {
            width: 100%;
            max-width: 1000px;
            margin: 20px auto;
            display: block;
        }
        .project-description {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin: 20px 0;
        }
        .project-description p {
            margin: 10px 0;
            line-height: 1.6;
        }
        .project-description a {
            color: #4CAF50;
            text-decoration: none;
        }
        .project-description a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>UK Polling Analysis</h1>
        <p>This project analyzes polling data from various pollsters across the UK, tracking support for different political parties over time.</p>
        
        <div class="project-description">
            <p>This project uses only polls published on <a href="https://en.wikipedia.org/wiki/Opinion_polling_for_the_next_United_Kingdom_general_election" target="_blank">Wikipedia</a>.</p>
            
            <p>The Wikipedia table was imported into excel and cleaned, in particular dates formats. Where polls were conducted over a number of days, the date was set to the last day to enable plotting.</p>
            
            <p>The plot uses a 14 day LOESS, smoothing out the lines and avoiding severe fluctuations, while still being responsive to short term changes.</p>
            
            <p>The Latest Polling Averages represent the average of all polls on the latest date available.</p>
            
            <p>The Average Support represents the average of every poll in the dataset.</p>
        </div>
        
        <div class="code-section">
            <button class="code-button" onclick="showCode()">Show Analysis Code</button>
        </div>

        <div id="codeModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeCodeModal()">&times;</span>
                <h2>Python Analysis Code</h2>
                <pre><code>import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
import statsmodels.api as sm
from datetime import datetime

# Set the style for seaborn
sns.set_style("whitegrid")
plt.rcParams['figure.figsize'] = [14, 8]

# Read the CSV file
df = pd.read_csv("polls.csv")

# Convert date column to datetime
df['Date'] = pd.to_datetime(df['Date'], format='%d/%m/%Y')
df['Date_Numeric'] = (df['Date'] - df['Date'].min()).dt.days

# Group by date and calculate mean for each party
party_columns = ['Lab', 'Con', 'Ref', 'LD', 'Greens', 'Others']
daily_averages = df.groupby('Date')[party_columns].mean().reset_index()

# Sort by date
daily_averages['Date_Numeric'] = (daily_averages['Date'] - daily_averages['Date'].min()).dt.days

# Create the plot
plt.figure(figsize=(14, 8))
colors = {'Lab': 'red', 'Con': 'blue', 'Ref': 'purple', 'LD': 'orange', 'Greens': 'green', 'Others': 'grey'}

for party, color in colors.items():
    sns.regplot(
        x='Date_Numeric',
        y=party,
        data=daily_averages,
        lowess=True,
        scatter_kws={'alpha': 0.3},
        line_kws={'color': color, 'label': party, 'linewidth': 2}
    )

# Convert x-axis back to dates for labeling
date_ticks = daily_averages['Date'].sort_values().unique()
numeric_ticks = (date_ticks - daily_averages['Date'].min()).days
plt.gca().set_xticks(numeric_ticks)
plt.gca().set_xticklabels([d.strftime('%d/%m/%Y') for d in date_ticks], rotation=45)

plt.xlabel('Date')
plt.ylabel('Support (%)')
plt.title('UK Polling Trends with LOESS Smoothing')
plt.legend()
plt.tight_layout()
plt.savefig('polling_trends.png', dpi=300, bbox_inches='tight')

# Print some basic statistics
averages = daily_averages[party_columns].mean().round(1).sort_values(ascending=False)

# Print the sorted averages
print("\nAverage support by party:")
print(averages)

print("\nLatest polling averages:")
latest_date = daily_averages['Date'].max()
latest_polls = daily_averages[daily_averages['Date'] == latest_date]
print(f"\nAs of {latest_date.strftime('%d %B %Y')}:")
for party in party_columns:
    print(f"{party}: {latest_polls[party].values[0]:.1f}%")</code></pre>
            </div>
        </div>

        <div class="plot-container">
            
            <img src="Polling_project/polling_trends.png" alt="UK Party Support Over Time" class="python-plot">
            
            <div class="stats-container">
                <h3>Latest Polling Averages</h3>
                <p>As of 30 May 2025:</p>
                <div class="stats-grid">
                    <div class="stat-box" style="background-color: #12B6CF; color: white;">
                        <div class="stat-label">Reform</div>
                        <div class="stat-value">31.0%</div>
                    </div>
                    <div class="stat-box" style="background-color: #E4003B; color: white;">
                        <div class="stat-label">Labour</div>
                        <div class="stat-value">25.0%</div>
                    </div>
                    <div class="stat-box" style="background-color: #0087DC; color: white;">
                        <div class="stat-label">Conservative</div>
                        <div class="stat-value">17.0%</div>
                    </div>
                    <div class="stat-box" style="background-color: #FAA61A; color: white;">
                        <div class="stat-label">Liberal Democrats</div>
                        <div class="stat-value">11.0%</div>
                    </div>
                    <div class="stat-box" style="background-color: #6AB023; color: white;">
                        <div class="stat-label">Greens</div>
                        <div class="stat-value">10.0%</div>
                    </div>
                    <div class="stat-box" style="background-color: #999999; color: white;">
                        <div class="stat-label">Others</div>
                        <div class="stat-value">2.0%</div>
                    </div>
                </div>
            </div>

            <div class="stats-container">
                <h3>Average Support by Party</h3>
                <div class="stats-grid">
                    <div class="stat-box" style="background-color: #12B6CF; color: white;">
                        <div class="stat-label">Reform</div>
                        <div class="stat-value">26.2%</div>
                    </div>
                    <div class="stat-box" style="background-color: #E4003B; color: white;">
                        <div class="stat-label">Labour</div>
                        <div class="stat-value">24.4%</div>
                    </div>
                    <div class="stat-box" style="background-color: #0087DC; color: white;">
                        <div class="stat-label">Conservative</div>
                        <div class="stat-value">21.4%</div>
                    </div>
                    <div class="stat-box" style="background-color: #FAA61A; color: white;">
                        <div class="stat-label">Liberal Democrats</div>
                        <div class="stat-value">13.1%</div>
                    </div>
                    <div class="stat-box" style="background-color: #6AB023; color: white;">
                        <div class="stat-label">Greens</div>
                        <div class="stat-value">8.7%</div>
                    </div>
                    <div class="stat-box" style="background-color: #999999; color: white;">
                        <div class="stat-label">Others</div>
                        <div class="stat-value">2.8%</div>
                    </div>
                </div>
            </div>
        </div>

        <a href="index.html" class="back-link">← Back to Portfolio</a>
    </div>

    <script>
        // Modal functionality
        function showCode() {
            document.getElementById('codeModal').style.display = 'block';
        }

        function closeCodeModal() {
            document.getElementById('codeModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            var modal = document.getElementById('codeModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html> 